{
  "version": "1.0.0",
  "metadata": {
    "project": "Shafran ecommerce UI",
    "description": "Backend data model capturing entities and relationships surfaced across the Shafran storefront, authentication, profile, cart, and checkout flows.",
    "generatedAt": "2024-02-18T00:00:00Z"
  },
  "enums": {
    "GenderAudience": {
      "description": "Target audience used across catalogue navigation and merchandising cards.",
      "values": ["female", "male", "unisex"]
    },
    "OrderStatus": {
      "description": "Lifecycle states surfaced in the profile order history.",
      "values": ["pending", "processing", "shipped", "delivered", "cancelled"]
    },
    "PaymentMethodType": {
      "description": "Payment methods selectable during checkout.",
      "values": ["cash", "card", "digital_wallet"]
    },
    "DeliveryMethodType": {
      "description": "Delivery fulfilment choices in the checkout accordion.",
      "values": ["address_delivery", "store_pickup"]
    },
    "BonusTransactionType": {
      "description": "Types of loyalty balance movements shown in the bonus history table.",
      "values": ["earned", "spent", "adjustment"]
    },
    "BonusTransactionStatus": {
      "description": "Status badges displayed for loyalty transactions.",
      "values": ["received", "pending", "spent", "cancelled"]
    },
    "ProductHighlightType": {
      "description": "Marketing highlight formats rendered on the product detail marquee.",
      "values": ["text_ticker", "media_carousel"]
    }
  },
  "entities": {
    "User": {
      "description": "Registered customer account with authentication credentials and greeting name.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "phoneNumber": { "type": "string", "format": "phone" },
        "email": { "type": "string", "format": "email", "nullable": true },
        "firstName": { "type": "string" },
        "lastName": { "type": "string", "nullable": true },
        "displayName": { "type": "string", "description": "Name used in profile greeting (e.g. 'Привет Азиз')." },
        "passwordHash": { "type": "string", "description": "Hashed password used for login." },
        "createdAt": { "type": "datetime" },
        "updatedAt": { "type": "datetime" },
        "lastLoginAt": { "type": "datetime", "nullable": true }
      }
    },
    "UserProfile": {
      "description": "Extended profile preferences and default address surfaced in the profile tab.",
      "primaryKey": "userId",
      "fields": {
        "userId": { "type": "uuid" },
        "primaryPhone": { "type": "string", "format": "phone" },
        "defaultAddressId": { "type": "uuid", "nullable": true },
        "marketingOptIn": { "type": "boolean", "default": false },
        "notes": { "type": "string", "nullable": true },
        "updatedAt": { "type": "datetime" }
      }
    },
    "Address": {
      "description": "User saved delivery addresses shown and editable under profile addresses and checkout delivery selection.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid" },
        "label": { "type": "string", "description": "Display label such as 'Адрес 1'." },
        "addressLine": { "type": "string" },
        "apartment": { "type": "string", "nullable": true },
        "city": { "type": "string", "nullable": true },
        "district": { "type": "string", "nullable": true },
        "postalCode": { "type": "string", "nullable": true },
        "isDefault": { "type": "boolean", "default": false },
        "createdAt": { "type": "datetime" },
        "updatedAt": { "type": "datetime" }
      }
    },
    "Brand": {
      "description": "Perfume brands used for filtering and product association.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "description": { "type": "string", "nullable": true },
        "country": { "type": "string", "nullable": true },
        "logoImage": { "type": "string", "nullable": true }
      }
    },
    "Category": {
      "description": "Catalogue groupings such as gender-specific perfume collections shown on landing sections.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "slug": { "type": "string" },
        "genderAudience": { "type": "enum", "enumRef": "GenderAudience" },
        "subtitle": { "type": "string", "nullable": true },
        "description": { "type": "string", "nullable": true },
        "heroImageLight": { "type": "string", "nullable": true },
        "heroImageDark": { "type": "string", "nullable": true },
        "cardImage": { "type": "string", "nullable": true },
        "displayOrder": { "type": "integer" },
        "filterConfig": {
          "type": "object",
          "properties": {
            "price": {
              "type": "object",
              "properties": {
                "min": { "type": "decimal" },
                "max": { "type": "decimal" },
                "step": { "type": "decimal" }
              }
            },
            "supportsUnisexToggle": { "type": "boolean" },
            "brandIds": { "type": "array", "items": "uuid" },
            "fragranceNoteIds": { "type": "array", "items": "uuid" },
            "seasonIds": { "type": "array", "items": "uuid" },
            "productTypeIds": { "type": "array", "items": "uuid" }
          }
        }
      }
    },
    "AudienceSegment": {
      "description": "Landing page cards labelled 'ДЛЯ НЕЁ / ДЛЯ НЕГО / УНИ' with supporting imagery.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "title": { "type": "string" },
        "subtitle": { "type": "string" },
        "genderAudience": { "type": "enum", "enumRef": "GenderAudience" },
        "productTypeLabel": { "type": "string", "description": "Small caption such as 'Парфюм'." },
        "cardImage": { "type": "string" },
        "categoryId": { "type": "uuid", "nullable": true },
        "displayOrder": { "type": "integer" }
      }
    },
    "HomepageHeroPanel": {
      "description": "Hero background configurations for the two landing sections with light/dark artwork and logo treatment.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "section": { "type": "string", "description": "Semantic identifier such as 'home-intro' or 'category-highlight'." },
        "backgroundImageLight": { "type": "string" },
        "backgroundImageDark": { "type": "string" },
        "overlayLogoLight": { "type": "string" },
        "overlayLogoDark": { "type": "string" },
        "displayOrder": { "type": "integer" }
      }
    },
    "FragranceNote": {
      "description": "Named aroma options surfaced in the sidebar filter (e.g. 'Альдегидные').",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "noteType": { "type": "string", "nullable": true }
      }
    },
    "Season": {
      "description": "Seasonal suitability filter values.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "displayOrder": { "type": "integer" }
      }
    },
    "ProductType": {
      "description": "Product type filter values such as 'Парфюм' or 'Одеколон'.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "displayOrder": { "type": "integer" }
      }
    },
    "Product": {
      "description": "Sellable perfume with gallery, specifications, pricing, and associations.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "slug": { "type": "string" },
        "name": { "type": "string" },
        "brandId": { "type": "uuid" },
        "categoryId": { "type": "uuid" },
        "genderAudience": { "type": "enum", "enumRef": "GenderAudience" },
        "shortDescription": { "type": "string", "description": "Summary used in cards and cart items." },
        "longDescription": { "type": "string", "nullable": true },
        "ratingAverage": { "type": "decimal", "nullable": true },
        "ratingCount": { "type": "integer", "nullable": true },
        "basePrice": { "type": "decimal", "description": "Default price for highlighted variant." },
        "currency": { "type": "string", "default": "USD" },
        "releaseYear": { "type": "integer", "nullable": true },
        "manufacturer": { "type": "string", "nullable": true },
        "isTesterAvailable": { "type": "boolean", "default": false },
        "fragranceFamily": { "type": "string", "nullable": true },
        "fragranceGroup": { "type": "string", "nullable": true },
        "compositionNotes": { "type": "string", "nullable": true },
        "countryOfOrigin": { "type": "string", "nullable": true },
        "heroImage": { "type": "string", "nullable": true },
        "thumbnailImage": { "type": "string", "nullable": true },
        "isPublished": { "type": "boolean", "default": true }
      }
    },
    "ProductVariant": {
      "description": "Purchasable SKU variations such as 100 мл testers and pricing tiers.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "sku": { "type": "string" },
        "label": { "type": "string", "description": "Display label (e.g. '100 мл')." },
        "volumeMl": { "type": "decimal", "nullable": true },
        "price": { "type": "decimal" },
        "currency": { "type": "string", "default": "USD" },
        "isTester": { "type": "boolean", "default": false },
        "inventoryQuantity": { "type": "integer", "nullable": true },
        "isActive": { "type": "boolean", "default": true }
      }
    },
    "ProductMedia": {
      "description": "Image assets for galleries and marketing marquees.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "url": { "type": "string" },
        "type": { "type": "string", "description": "e.g. gallery, marketing" },
        "altText": { "type": "string", "nullable": true },
        "displayOrder": { "type": "integer" },
        "theme": { "type": "string", "nullable": true }
      }
    },
    "ProductSpecification": {
      "description": "Tabular key/value specifications rendered under the 'ПАРАМЕТРЫ' tab.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "label": { "type": "string" },
        "value": { "type": "string" },
        "displayOrder": { "type": "integer" }
      }
    },
    "ProductDescriptionBlock": {
      "description": "Paragraph content displayed inside the 'ОПИСАНИЯ' tab.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "content": { "type": "string" },
        "displayOrder": { "type": "integer" }
      }
    },
    "ProductHighlight": {
      "description": "Scrolling marquee highlights including text blurbs and promotional imagery.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "highlightType": { "type": "enum", "enumRef": "ProductHighlightType" },
        "text": { "type": "string", "nullable": true },
        "mediaItems": { "type": "array", "items": "string", "nullable": true },
        "displayOrder": { "type": "integer" }
      }
    },
    "ProductRelation": {
      "description": "Related product groupings for the 'Похожие товары' grid.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "relatedProductIds": { "type": "array", "items": "uuid" },
        "title": { "type": "string", "default": "Похожие товары" }
      }
    },
    "ProductFragranceNote": {
      "description": "Join table linking products to selectable aroma filters.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "fragranceNoteId": { "type": "uuid" }
      }
    },
    "ProductSeason": {
      "description": "Join table connecting products to season filter chips.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "seasonId": { "type": "uuid" }
      }
    },
    "ProductUsageType": {
      "description": "Join table for product to type filter assignments (e.g. Парфюм).",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "productId": { "type": "uuid" },
        "productTypeId": { "type": "uuid" }
      }
    },
    "Cart": {
      "description": "Active shopping basket backing the header dropdown and checkout summary.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid", "nullable": true },
        "sessionId": { "type": "string", "nullable": true },
        "currency": { "type": "string", "default": "USD" },
        "subtotal": { "type": "decimal", "default": 0 },
        "totalItems": { "type": "integer", "default": 0 },
        "bonusApplied": { "type": "decimal", "default": 0 },
        "createdAt": { "type": "datetime" },
        "updatedAt": { "type": "datetime" }
      }
    },
    "CartItem": {
      "description": "Line items shown inside the cart dropdown with quantity controls.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "cartId": { "type": "uuid" },
        "productVariantId": { "type": "uuid" },
        "productName": { "type": "string" },
        "variantLabel": { "type": "string", "nullable": true },
        "thumbnailImage": { "type": "string", "nullable": true },
        "unitPrice": { "type": "decimal" },
        "quantity": { "type": "integer" },
        "lineTotal": { "type": "decimal" }
      }
    },
    "Order": {
      "description": "Confirmed purchases listed in the profile order history and checkout success screen.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid" },
        "orderNumber": { "type": "string" },
        "status": { "type": "enum", "enumRef": "OrderStatus" },
        "placedAt": { "type": "datetime" },
        "currency": { "type": "string", "default": "USD" },
        "subtotal": { "type": "decimal" },
        "shippingFee": { "type": "decimal", "default": 0 },
        "total": { "type": "decimal" },
        "deliveryMethod": { "type": "enum", "enumRef": "DeliveryMethodType" },
        "deliveryAddressId": { "type": "uuid", "nullable": true },
        "pickupBranchId": { "type": "uuid", "nullable": true },
        "paymentMethod": { "type": "enum", "enumRef": "PaymentMethodType" },
        "paymentDetailId": { "type": "uuid", "nullable": true },
        "bonusApplied": { "type": "decimal", "default": 0 },
        "bonusTransactionId": { "type": "uuid", "nullable": true }
      }
    },
    "OrderItem": {
      "description": "Individual order line mirroring cart entries for receipts and history tables.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "orderId": { "type": "uuid" },
        "productVariantId": { "type": "uuid" },
        "productName": { "type": "string" },
        "variantLabel": { "type": "string", "nullable": true },
        "quantity": { "type": "integer" },
        "unitPrice": { "type": "decimal" },
        "lineTotal": { "type": "decimal" }
      }
    },
    "PaymentDetail": {
      "description": "Stored payment metadata captured from the checkout accordion (card digits, digital wallet choice).",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "orderId": { "type": "uuid" },
        "methodType": { "type": "enum", "enumRef": "PaymentMethodType" },
        "cardToken": { "type": "string", "nullable": true },
        "cardLast4": { "type": "string", "nullable": true },
        "cardExpiryMonth": { "type": "integer", "nullable": true },
        "cardExpiryYear": { "type": "integer", "nullable": true },
        "digitalProviderId": { "type": "uuid", "nullable": true },
        "transactionReference": { "type": "string", "nullable": true }
      }
    },
    "PickupBranch": {
      "description": "Store pickup locations listed under the 'Самовывоз' delivery method.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "addressLine": { "type": "string" },
        "district": { "type": "string", "nullable": true },
        "coordinates": { "type": "string", "nullable": true },
        "workingHours": { "type": "string", "nullable": true },
        "contactPhone": { "type": "string", "nullable": true },
        "isActive": { "type": "boolean", "default": true }
      }
    },
    "DigitalPaymentProvider": {
      "description": "Digital wallet options (Payme, Click, Uzum) selectable in checkout.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "name": { "type": "string" },
        "brandColor": { "type": "string", "nullable": true },
        "logoImage": { "type": "string", "nullable": true },
        "isActive": { "type": "boolean", "default": true }
      }
    },
    "BonusAccount": {
      "description": "Customer loyalty balance displayed in the bonus overview card.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid" },
        "balance": { "type": "decimal" },
        "currency": { "type": "string", "default": "UZS" },
        "lastUpdatedAt": { "type": "datetime" }
      }
    },
    "BonusTransaction": {
      "description": "Loyalty accrual and spend entries powering the transaction table.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "bonusAccountId": { "type": "uuid" },
        "orderId": { "type": "uuid", "nullable": true },
        "transactionNumber": { "type": "string" },
        "transactionType": { "type": "enum", "enumRef": "BonusTransactionType" },
        "status": { "type": "enum", "enumRef": "BonusTransactionStatus" },
        "amount": { "type": "decimal" },
        "currency": { "type": "string", "default": "UZS" },
        "occurredAt": { "type": "datetime" }
      }
    },
    "OneClickOrderRequest": {
      "description": "Quick purchase intents triggered by the 'Купить в 1 клик' button on product detail.",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid", "nullable": true },
        "productVariantId": { "type": "uuid" },
        "contactPhone": { "type": "string", "format": "phone" },
        "preferredDeliveryMethod": { "type": "enum", "enumRef": "DeliveryMethodType", "nullable": true },
        "notes": { "type": "string", "nullable": true },
        "status": { "type": "string", "default": "new" },
        "createdAt": { "type": "datetime" }
      }
    },
    "AuthSession": {
      "description": "Server-side session for authenticated users (supports persistent login).",
      "primaryKey": "id",
      "fields": {
        "id": { "type": "uuid" },
        "userId": { "type": "uuid" },
        "refreshToken": { "type": "string" },
        "expiresAt": { "type": "datetime" },
        "createdAt": { "type": "datetime" },
        "revokedAt": { "type": "datetime", "nullable": true }
      }
    }
  },
  "relationships": [
    {
      "from": "UserProfile.userId",
      "to": "User.id",
      "type": "one-to-one",
      "description": "Each user has a single profile record backing profile tab fields."
    },
    {
      "from": "Address.userId",
      "to": "User.id",
      "type": "many-to-one",
      "description": "Users can store multiple delivery addresses."
    },
    {
      "from": "UserProfile.defaultAddressId",
      "to": "Address.id",
      "type": "one-to-one",
      "description": "Reference for the default address badge shown in profile addresses."
    },
    {
      "from": "Product.brandId",
      "to": "Brand.id",
      "type": "many-to-one",
      "description": "Products belong to a brand displayed on cards and specs."
    },
    {
      "from": "Product.categoryId",
      "to": "Category.id",
      "type": "many-to-one",
      "description": "Products are grouped under catalogue categories used for navigation."
    },
    {
      "from": "ProductVariant.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Variants provide purchasable sizes for a product."
    },
    {
      "from": "ProductMedia.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Gallery images and marketing assets belong to a product."
    },
    {
      "from": "ProductSpecification.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Specifications populate the parameters tab for a product."
    },
    {
      "from": "ProductDescriptionBlock.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Narrative paragraphs render in the description tab."
    },
    {
      "from": "ProductHighlight.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Marquee highlights are tied to a product detail page."
    },
    {
      "from": "ProductRelation.productId",
      "to": "Product.id",
      "type": "many-to-one",
      "description": "Defines related product groupings for detail page recommendations."
    },
    {
      "from": "ProductRelation.relatedProductIds",
      "to": "Product.id",
      "type": "many-to-many",
      "description": "Recommended products displayed in the 'Похожие товары' grid."
    },
    {
      "from": "ProductFragranceNote.productId",
      "to": "Product.id",
      "type": "many-to-one"
    },
    {
      "from": "ProductFragranceNote.fragranceNoteId",
      "to": "FragranceNote.id",
      "type": "many-to-one"
    },
    {
      "from": "ProductSeason.productId",
      "to": "Product.id",
      "type": "many-to-one"
    },
    {
      "from": "ProductSeason.seasonId",
      "to": "Season.id",
      "type": "many-to-one"
    },
    {
      "from": "ProductUsageType.productId",
      "to": "Product.id",
      "type": "many-to-one"
    },
    {
      "from": "ProductUsageType.productTypeId",
      "to": "ProductType.id",
      "type": "many-to-one"
    },
    {
      "from": "Cart.userId",
      "to": "User.id",
      "type": "many-to-one",
      "description": "Authenticated carts are owned by a user."
    },
    {
      "from": "CartItem.cartId",
      "to": "Cart.id",
      "type": "many-to-one"
    },
    {
      "from": "CartItem.productVariantId",
      "to": "ProductVariant.id",
      "type": "many-to-one"
    },
    {
      "from": "Order.userId",
      "to": "User.id",
      "type": "many-to-one"
    },
    {
      "from": "Order.deliveryAddressId",
      "to": "Address.id",
      "type": "many-to-one"
    },
    {
      "from": "Order.pickupBranchId",
      "to": "PickupBranch.id",
      "type": "many-to-one"
    },
    {
      "from": "Order.paymentDetailId",
      "to": "PaymentDetail.id",
      "type": "one-to-one"
    },
    {
      "from": "OrderItem.orderId",
      "to": "Order.id",
      "type": "many-to-one"
    },
    {
      "from": "OrderItem.productVariantId",
      "to": "ProductVariant.id",
      "type": "many-to-one"
    },
    {
      "from": "PaymentDetail.digitalProviderId",
      "to": "DigitalPaymentProvider.id",
      "type": "many-to-one"
    },
    {
      "from": "BonusAccount.userId",
      "to": "User.id",
      "type": "one-to-one"
    },
    {
      "from": "BonusTransaction.bonusAccountId",
      "to": "BonusAccount.id",
      "type": "many-to-one"
    },
    {
      "from": "BonusTransaction.orderId",
      "to": "Order.id",
      "type": "many-to-one",
      "description": "Earn/spend rows can reference the originating order."
    },
    {
      "from": "OneClickOrderRequest.userId",
      "to": "User.id",
      "type": "many-to-one"
    },
    {
      "from": "OneClickOrderRequest.productVariantId",
      "to": "ProductVariant.id",
      "type": "many-to-one"
    },
    {
      "from": "AuthSession.userId",
      "to": "User.id",
      "type": "many-to-one"
    },
    {
      "from": "AudienceSegment.categoryId",
      "to": "Category.id",
      "type": "many-to-one"
    }
  ]
}
